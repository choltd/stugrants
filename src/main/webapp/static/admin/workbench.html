<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../css/admin/workbench.css" type="text/css" rel="stylesheet">
    <style>
        div button:active {
            opacity: 0.3;
        }

        div button {
            border-radius: 2rem;
            height: 3rem;
            width: 11.6rem;
            border: 0;
        }
    </style>
</head>

<body>
<div id="content">
    <div class="left">
        <div class="form">
            <p>统计</p>
            <table id="tjb">
                <tr>
                    <td>学生</td>
                    <td>申请</td>
                    <td>教师</td>
                    <td>审核</td>
                    <td>资助</td>
                </tr>
            </table>
        </div>
        <div id="ec" class="echarts">

        </div>
    </div>
    <div class="right">
        <p>系统信息</p>
        <ul id="info">
            <li><span style="display: inline-block;width: 20px;"> > </span>新增了一条资助申请，请查看...</li>
            <li><span style="display: inline-block;width: 20px;"> > </span>新增了一条资助申请，请查看...</li>
            <li><span style="display: inline-block;width: 20px;"> > </span>新增了一条资助申请，请查看...</li>
            <li><span style="display: inline-block;width: 20px;"> > </span>新增了一条资助审核，请查看...</li>
            <li><span style="display: inline-block;width: 20px;"> > </span>新增了一条资助审核，请查看...</li>
            <li><span style="margin-left: 42%;">......</span></li>
        </ul>
        <div style="position: absolute;bottom: 50px;">
            <button id="pg">发布资助</button>
            <button id="pl" disabled="disabled">发布名单</button>
        </div>
    </div>
</div>
</body>
<script src="../js/jquery-3.4.1.min.js"></script>
<script src="../js/jquery.cookie.js"></script>
<script src="../js/echarts.min.js"></script>
<script>
    $(function () {
        getCharts();
        if($("#info li").length > 10){
            $("#pl").removeAttr("disabled")
        }
        $("#pg").click(function () {
            $.cookie("grants", "begin", {expires: 1, path: "/"})
            alert("已发布资助信息")
        })
        $("#pl").click(function () {
            $.cookie("roster", "begin", {expires: 1, path: "/"})
            alert("已发布资助名单")
        })
    })

    function getCharts() {
        $.ajax({
            url: "/admin?act=getCharts",
            dataType: "json",
            type: "get",
            success: function (data) {
                var html = "<tr>";
                var arr = [];
                $.each(data.dataList, function (i, e) {
                    html += "<td><a href='javascript:void(0);' onclick='goto('" + e.name + "');'>" + e.value + "</a></td>";
                    arr.push(e.name);
                })
                $("#tjb").append(html);
                var chartDom = document.getElementById('ec');
                var myChart = echarts.init(chartDom);
                var option;

                option = {
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        orient: 'vertical',
                        right: '10%',
                        top: 'center',
                        data: arr
                    },
                    series: [
                        {
                            name: '统计',
                            type: 'pie',
                            center: ['45%', '50%'],
                            radius: ['40%', '70%'],
                            avoidLabelOverlap: false,
                            itemStyle: {
                                normal: {
                                    borderColor: '#fff',
                                    borderWidth: 2
                                }
                            },
                            label: {
                                show: true
                            },

                            labelLine: {
                                show: true
                            },
                            data: data.dataList
                        }
                    ]
                };

                option && myChart.setOption(option);

                window.addEventListener("resize", function () {
                    myChart.resize();
                });
                $("#ec").css({"background-color": "#fff", "margin-top": "15px"});
            }
        })
    }

    function goto(name) {
        switch (name) {
            case 'student':
                window.location.href = "stuInfo.html";
                break;
            case 'teacher':
                window.location.href = "tchInfo.html";
                break;
            case 'filed':
                window.location.href = "fieldInfo.html";
                break;
            case 'review':
                window.location.href = "reviewInfo.html";
                break;
            case 'grants':
                window.location.href = "grantsInfo.html";
                break;
        }
    }

</script>

</html>